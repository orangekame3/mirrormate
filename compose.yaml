# Production deployment (Raspberry Pi / any host)
# Runs UI only, connects to Mac Studio via Tailscale for heavy services
# Usage: docker compose up -d
#
# Set STUDIO_IP in .env to your Mac Studio's Tailscale IP:
#   STUDIO_IP=100.x.x.x
# Get it with: tailscale ip -4

services:
  mirrormate:
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - "3000:3000"
    environment:
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - GOOGLE_SERVICE_ACCOUNT_EMAIL=${GOOGLE_SERVICE_ACCOUNT_EMAIL}
      - GOOGLE_PRIVATE_KEY=${GOOGLE_PRIVATE_KEY}
      - GOOGLE_CALENDAR_ID=${GOOGLE_CALENDAR_ID}
      - TAVILY_API_KEY=${TAVILY_API_KEY}
      - DISCORD_WEBHOOK_URL=${DISCORD_WEBHOOK_URL}
    extra_hosts:
      - "studio:${STUDIO_IP}"
    volumes:
      - ./config:/app/config:ro
      - mirrormate-data:/app/data
    restart: unless-stopped

volumes:
  mirrormate-data:
